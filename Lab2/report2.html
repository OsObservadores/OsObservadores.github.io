<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>

<h1 id="relat-rio-laborat-rio-1">Relatório Laboratório 2 - Calibração de Câmeras</h1>
<p>Jorge Luiz Pinto Junior  - RA: 11058715 - CEO</p>
<p>Marcos Baldrigue Andrade - RA: 11201921777 - CFO - Financeiro</p>
<p>Guilherme Eduardo Pereira - RA: 11201720498 - CPO - Desenvolvimento</p>
<p>Data de realização do experimento: 25/06/2025</p>
<p>Data de publicação do relatório: 02/07/2025</p>
<h2 id="introdu-o">Introdução</h2>

<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
Este laboratório experimental tem como objetivo proporcionar aos alunos a compreensão dos conceitos fundamentais relacionados aos parâmetros intrínsecos e extrínsecos de câmeras, por meio da realização de um experimento prático de calibração. A atividade é dividida em quatro etapas sequenciais. Na primeira (Etapa A), realiza-se a calibração de uma câmera utilizando imagens fornecidas previamente, com o auxílio do programa L2_cal.py. Em seguida (Etapa B), os alunos geram suas próprias imagens com auxílio do programa L2_chess.py, capturando um padrão de tabuleiro de xadrez em diferentes orientações, e as utilizam para uma nova calibração com o L2_cal.py. Na terceira fase (Etapa C), o mesmo procedimento é repetido com uma segunda câmera, que apresenta maior distorção óptica. Por fim (Etapa D), os alunos produzem imagens adicionais com essa segunda câmera, com o objetivo de aplicar a correção de distorções previamente identificadas. 
</p> 

<h2 id="procedimentos-experimentais">Procedimentos Experimentais</h2>

<h3 id="-a-leitura-de-imagem-em-arquivo">(A) Calibração de câmera com imagens fornecidas.</h3>

<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
O programa abaixo (L2_cal.py) executa o processo de calibração de câmeras e tem por resultado os seguintes parâmetros: a matriz <strong>K</strong>, o vetor <strong>R</strong> , o vetor <strong>d</strong> e o vetor <strong>t</strong>. Estes parâmetros são explicados em detalhes na sessão de <strong>Análise dos Resultados</strong>. A execução correta do programa exige que o mesmo esteja dentro da pasta contendo as imagens que serão utilizadas para a calibração, nesta mesma pasta foi aberto o terminal do linux para execução do programa.
</p> 

<pre>
<code class="language-python">
import cv2
import numpy as np
import os
import glob

# Defining the dimensions of checkerboard
CHECKERBOARD = (6,9)
criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 30, 0.001)

# Creating vector to store vectors of 3D points for each checkerboard image
objpoints = []
# Creating vector to store vectors of 2D points for each checkerboard image
imgpoints = [] 

# Defining the world coordinates for 3D points
objp = np.zeros((1, CHECKERBOARD[0] * CHECKERBOARD[1], 3), np.float32)
objp[0,:,:2] = np.mgrid[0:CHECKERBOARD[0], 0:CHECKERBOARD[1]].T.reshape(-1, 2)

# Extracting path of individual image stored in a given directory
images = glob.glob('*.jpg')
for fname in images:
    img = cv2.imread(fname)
    gray = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)
    ret, corners = cv2.findChessboardCorners(
        gray, CHECKERBOARD, 
        cv2.CALIB_CB_ADAPTIVE_THRESH + 
        cv2.CALIB_CB_FAST_CHECK + 
        cv2.CALIB_CB_NORMALIZE_IMAGE)
    
    if ret == True:
        objpoints.append(objp)
        corners2 = cv2.cornerSubPix(gray, corners, (11,11), (-1,-1), criteria)
        imgpoints.append(corners2)
        img = cv2.drawChessboardCorners(img, CHECKERBOARD, corners2, ret)
    
    cv2.imshow('img', img)
    cv2.waitKey(0)

cv2.destroyAllWindows()

h, w = img.shape[:2]

ret, mtx, dist, rvecs, tvecs = cv2.calibrateCamera(
    objpoints, imgpoints, gray.shape[::-1], None, None)

print("Camera matrix : \n", mtx)
print("dist : \n", dist)
print("rvecs : \n", rvecs)
print("tvecs : \n", tvecs)
</code>
</pre>

<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
  A seguir são mostradas as imagens utilizadas para calibrar a câmera. As imagens processadas pelo programa são mostradas na sessão <strong>Análise dos Resultados</strong>.
</p>

<div style="display: flex; justify-content: center; gap: 1px;">
  <img src="/Lab2/samples/left01.jpg" alt="letf01" width="200" height=" 100">
  <img src="/Lab2/samples/left02.jpg" alt="letf02" width="200" height=" 100">
  <img src="/Lab2/samples/left03.jpg" alt="letf03" width="200" height=" 100">
  <img src="/Lab2/samples/left04.jpg" alt="letf04" width="200" height=" 100">
  <img src="/Lab2/samples/left05.jpg" alt="letf05" width="200" height=" 100">
  <img src="/Lab2/samples/left06.jpg" alt="letf06" width="200" height=" 100">
  <img src="/Lab2/samples/left07.jpg" alt="letf07" width="200" height=" 100">
</div>

<div style="display: flex; justify-content: center; gap: 1px;">
  <img src="/Lab2/samples/left08.jpg" alt="letf08" width="200" height=" 100">
  <img src="/Lab2/samples/left09.jpg" alt="letf09" width="200" height=" 100">
  <img src="/Lab2/samples/left11.jpg" alt="letf11" width="200" height=" 100">
  <img src="/Lab2/samples/left12.jpg" alt="letf12" width="200" height=" 100">
  <img src="/Lab2/samples/left13.jpg" alt="letf13" width="200" height=" 100">
  <img src="/Lab2/samples/left14.jpg" alt="letf14" width="200" height=" 100">
</div>

<div style="display: flex; justify-content: center">
  <figcaption>Figura 1 - Samples.</figcaption>
</div>


<h3 id="-b-leitura-de-v-deo-em-arquivo">(B) Calibração da sua webcam com a captura de suas próprias imagens.</h3>

<h3 id="-c-leitura-de-imagem-de-c-mera">(C) Calibração de outra câmera do laboratório</h3>

<h3 id="-d-grava-o-de-v-deo-da-c-mera">(D) Correção de distorção de imagens.</h3>


<h2 id="analise-dos-resultados">Análise dos Resultados</h2>

<h3 id="-a-leitura-de-imagem-em-arquivo">(A) Calibração de câmera com imagens fornecidas.</h3>



<pre><code>
    Camera matrix : 

[[536.07345295   0.         342.37047283]
 [  0.         536.01636331 235.53687701]
 [  0.           0.           1.        ]]
dist : 

[[-0.26509044 -0.04674186  0.00183301 -0.00031469  0.25231154]]
rvecs : 

(array([[-0.08398729],
       [ 0.34802798],
       [-1.54244125]]), array([[-0.27527313],
       [ 0.10123349],
       [-1.56296568]]), array([[-0.22584613],
       [ 1.0155115 ],
       [-2.79470623]]), array([[ 0.05280128],
       [-0.60171832],
       [-0.18453815]]), array([[-0.10141629],
       [ 0.32034812],
       [ 0.3147293 ]]), array([[-0.34698232],
       [-0.06738512],
       [-1.20088998]]), array([[0.06525918],
       [0.44701842],
       [0.10800013]]), array([[ 0.49542336],
       [ 0.11948808],
       [-0.29675958]]), array([[-0.37463355],
       [ 0.06982818],
       [-0.01937111]]), array([[-0.35339067],
       [ 0.24071863],
       [ 0.20970027]]), array([[-0.4735952 ],
       [ 0.08970834],
       [-0.22605981]]), array([[ 0.19721096],
       [-0.42009963],
       [-0.1949708 ]]), array([[ 0.48287277],
       [-0.17037078],
       [-1.40740327]]))
tvecs : 

(array([[-2.96218417],
       [ 0.57158932],
       [16.83013775]]), array([[-3.99388098],
       [ 2.27704343],
       [12.68878108]]), array([[ 2.53399419],
       [ 4.31999128],
       [13.71919122]]), array([[-2.16838794],
       [-3.50011196],
       [10.73694991]]), array([[-3.72585434],
       [-4.3108485 ],
       [17.20439703]]), array([[-3.427436  ],
       [ 0.4873819 ],
       [11.56153507]]), array([[ 2.20741839],
       [-3.21446613],
       [15.60125394]]), array([[-3.40557514],
       [-2.41042315],
       [12.58706804]]), array([[-2.95848731],
       [-3.94417974],
       [13.21423743]]), array([[-1.59004095],
       [-4.31771235],
       [14.01040668]]), array([[-2.51791826],
       [-3.43069105],
       [12.85702135]]), array([[-2.67642941],
       [-3.18945602],
       [10.58262241]]), array([[-3.50264637],
       [ 1.61595404],
       [11.97222152]]))

</p> 
</code></pre>

<h3> Explicando os significados de K, R, t, e dist.</h3>

<h4> Explicando a matriz k</h4>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
    A matriz de parâmetros intrínsecos da câmera chamada de K tem esse padrão:
</p> 
<code>
    [[fx    0.    cx]<br>
    [0.    fy    cy]<br>
    [0.    0.    1.]]
    
</code>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
    Onde f_x, f_y representam o foco da câmera em pixels (relacionado à distância focal real e tamanho dos pixels), 
    c_x e c_y o centro óptico (geralmente o centro da imagem) e is zeros e o 1 na terceira linha são convenções da forma homogênea.
</p> 


<h4>Explicando o vetor R</h4>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
    Cada vetor r representa a rotação da câmera em relação ao mundo 3D (o tabuleiro de xadrez), para cada imagem usada na calibração.
    Esses vetores são em forma de rotação de Rodrigues, que é uma forma compacta de representar uma matriz de rotação 3x3.
</p> 


<h4>Explicando o vetor d</h4>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
    São os coeficientes de distorção da lente (termo dist):
</p> 
<code>
    [[ k1 k2  p1  p2  k3]]    
</code>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
    Onde k1, k2 e k3 representam a distorção radial (faz as linhas retas parecerem curvas); 
    p1 e p2 a Distorção tangencial (causada por desalinhamento da lente com o sensor).
    Esses valores são usados para corrigir as distorções da imagem, muito comum em lentes baratas ou câmeras tipo webcam.
</p> 

<h4>Explicando o vetor t</h4>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
    Cada t é a posição da câmera em relação ao sistema de coordenadas do tabuleiro de xadrez. Também é calculado para cada imagem de calibração.
</p>


<h3 id="-b-leitura-de-v-deo-em-arquivo">(B) Calibração da sua webcam com a captura de suas próprias imagens.</h3>
Camera matrix : 
<pre><code>
[[681.31313572   0.         338.83438339]
 [  0.         680.28102571 237.97905977]
 [  0.           0.           1.        ]]
dist : 

[[ 0.05471118 -0.23836225  0.00204913  0.00131733  0.62389174]]
rvecs : 

(array([[ 0.26322864],
       [-0.34981827],
       [-1.32321508]]), array([[ 0.2116112 ],
       [-0.67845162],
       [ 1.58437346]]), array([[-0.62979673],
       [ 0.16970115],
       [ 0.44629149]]), array([[-0.25428944],
       [-0.37829953],
       [ 1.3569295 ]]), array([[-0.60782013],
       [ 0.20990471],
       [ 1.44878658]]), array([[-0.03930657],
       [ 0.43935939],
       [ 0.07564065]]), array([[-0.01173043],
       [-0.20624347],
       [ 0.04343353]]), array([[ 0.14622958],
       [ 0.00891626],
       [-0.48988343]]), array([[-0.4256197 ],
       [ 0.53447939],
       [ 1.52917068]]), array([[ 0.04103005],
       [-0.61093764],
       [-0.12617062]]), array([[0.17272886],
       [0.13676318],
       [1.54935019]]), array([[-0.57484342],
       [-0.25358952],
       [-0.45894776]]), array([[-0.58606848],
       [-0.24621721],
       [-0.4505711 ]]), array([[-0.22169958],
       [-0.19357459],
       [ 1.45842311]]), array([[-0.10972886],
       [-0.21994229],
       [ 1.50904732]]))
tvecs : 

(array([[-4.33747823],
       [ 2.13449562],
       [12.45723853]]), array([[ 3.40912232],
       [-1.86336858],
       [11.35655984]]), array([[-1.46973137],
       [-4.36037833],
       [17.00324009]]), array([[ 2.71639352],
       [-3.45695725],
       [14.27153313]]), array([[ 2.60284186],
       [-2.54365767],
       [14.75721718]]), array([[-2.83528458],
       [-3.74506818],
       [17.21993768]]), array([[-1.38610851],
       [-3.44676457],
       [14.44166078]]), array([[-3.87938381],
       [-1.42681847],
       [16.6774393 ]]), array([[ 3.14630992],
       [-2.39024673],
       [13.62734449]]), array([[-2.76817882],
       [-3.32759211],
       [14.0338598 ]]), array([[ 2.89324534],
       [-2.60746396],
       [11.08565414]]), array([[-5.23329535],
       [-2.49602871],
       [15.74261591]]), array([[-5.0985607 ],
       [-2.510265  ],
       [15.62759254]]), array([[ 2.91085544],
       [-3.12904553],
       [12.5062273 ]]), array([[ 3.41157859],
       [-2.84304675],
       [12.53109819]]))
</code></pre>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
Responda: liste todos os parametros obtidos, colocando-os nas formas de matrizes e vetores
(Matriz K, matriz R, vetor t, vetor dos coeficientes de distorção). Compare e analise as
diferenças com o obtido no item anterior.
Apresente o valor númérico obtido pela calibração de sua câmera dos seguintes parâmetros:
focal length, aspect ratio, skew, principal point, e comente esse resultado obtido.
Qual o motivo de resultar um conjunto R e t para cada imagem usada na calibração? O que estas
variáveis R e t significam perante os sistemas de coordenadas envolvidos?
</p> 
    
<pre style = "text-align: left;"><code>import numpy <span class="hljs-keyword">as</span> np            # Importa a biblioteca NumPy, útil para lidar com arrays e operações numéricas
import cv2 <span class="hljs-keyword">as</span> cv              # Importa a biblioteca OpenCV, usada para capturar e processar imagens/vídeo

<span class="hljs-keyword">cap</span> = cv.VideoCapture(0)     # Abre a câmera padrão (geralmente a webcam). O argumento '0' representa a câmera principal

<span class="hljs-keyword">if</span> not <span class="hljs-keyword">cap</span>.isOpened():        # Verifica se a câmera foi aberta corretamente
    <span class="hljs-keyword">print</span>(<span class="hljs-string">"Cannot open camera"</span>)    # Se não abrir, imprime erro
    <span class="hljs-keyword">exit</span>()    # Sai do programa imediatamente

<span class="hljs-keyword">while</span> True:        # Loop infinito para capturar os frames da câmera em tempo real
    <span class="hljs-keyword">ret</span>, frame = <span class="hljs-keyword">cap</span>.<span class="hljs-keyword">read</span>()    # Lê um frame da câmera. 'ret' é True se a leitura foi bem-sucedida, 'frame' é a imagem capturada
    <span class="hljs-keyword">if</span> not <span class="hljs-keyword">ret</span>:    # Se não conseguir ler um frame (problema na câmera, desconexão, etc.)
    <span class="hljs-keyword">print</span>(<span class="hljs-string">"Can't receive frame (stream end?). Exiting ..."</span>)    # Mostra mensagem de erro
    <span class="hljs-keyword">break</span>    # Encerra o loop

    cv.imshow('frame', frame)    # Exibe o frame atual em uma janela chamada 'frame'

    <span class="hljs-keyword">if</span> cv.waitKey(1) == ord('q'):    # Espera 1 milissegundo por uma tecla. Se for 'q', sai do loop
        <span class="hljs-keyword">break</span>

<span class="hljs-keyword">cap</span>.release()                    # Libera a câmera para outros programas/sistemas
cv.destroyAllWindows()           # Fecha todas as janelas abertas pelo OpenCV
</code></pre>

<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
  A imagem a seguir mostra o a imagem com os avatares dos membros da equipe:
</p>

<figure style="text-align: center;">
  <img src="foto_grupo_avatar.png" alt="Figura 4 - avatares" width="1093" height="485">
  <figcaption>Figura 4 - Foto dos avatares em grupo.</figcaption>
</figure>

<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
  Parágrafo.
</p>

<figure style="text-align: center;">
  <video width="640" height="360" controls autoplay loop muted>
    <source src="video_pessoa_lento.mp4" type="video/mp4">
  </video>
  <figcaption>Vídeo 3 - Vídeo de movimentos lentos</figcaption>
</figure>

<h3 id="-c-leitura-de-imagem-de-c-mera">(C) Calibração de outra câmera do laboratório</h3>

<h3 id="-d-grava-o-de-v-deo-da-c-mera">(D) Correção de distorção de imagens.</h3>


<h2 id="conclus-o">Conclusão</h2>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">

</p>
<h2 id="Ref-s">Referências</h2>

<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
  https://docs.opencv.org/4.11.0/d8/d6a/group__imgcodecs__flags.html#gga61d9b0126a3e57d9277ac48327799c80ab6573b69300c092b61800222fe555953
</p>
<p style="text-align: justify; line-height: 1.5; text-indent: 2em;">
  https://docs.opencv.org/4.11.0/d2/de8/group__core__array.html#ga6c7adcc7771b452141c8f9a22a54bcf5
</p>


  
